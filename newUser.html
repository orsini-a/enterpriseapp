<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- en-tete du document -->

  <title>Un exemple</title>

  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
</head>

<body>
<script type="text/javascript">
function User()
{
this.username = "";
this.password = "";
this.mail = "";
//this.followers = "";
}

function surligne(champ, erreur)
{
   if(erreur)
      champ.style.backgroundColor = "#fba";
   else
      champ.style.backgroundColor = "";
}

function verifAge(champ)
{
   var age = parseInt(champ.value);
   if(isNaN(age) || age < 5 || age > 111)
   {
      surligne(champ, true);
      return false;
   }
   else
   {
      surligne(champ, false);
      return true;
   }
}

function verifMail(champ)
{
   var regex = /^[a-zA-Z0-9._-]+@[a-z0-9._-]{2,}\.[a-z]{2,4}$/;
   if(!regex.test(champ.value))
   {
      surligne(champ, true);
      return false;
   }
   else
   {
      surligne(champ, false);
      return true;
   }
}

function verifPseudo(champ)
{
   if(champ.value.length < 2 || champ.value.length > 25)
   {
      surligne(champ, true);
      return false;
   }
   else
   {
      surligne(champ, false);
      return true;
   }
}

function checkPass(mdp1, mdp2)
{
/*   var str1 = mdp1.toString();
  var str2 = mdp2.toString();
   
   var n = str1.localeCompare(str2);*/
if(mdp1.value === mdp2.value)
   return true;
else
   return false;
}

function verifPass(champ)
{
   if(champ.value.length < 2 || champ.value.length > 25)
   {
      surligne(champ, true);
      return false;
   }
   else
   {
      surligne(champ, false);
      return true;
   }
}

function newUserToJSon(pseudo, pass, mail, follow)
{
   consol.log("ok");
   var _user = new User(pseudo, pass, mail, follow);
   return JSON.stringify(_user);
}

function post(path, params, method) 
{
    $.ajax({
         crossDomain: true,
         url: path,
         type: "POST",
         data: params,
        // contentType: "application/json",
                  dataType: "json",
         success: function(result) {
             console.log("Response " + params);
          },
      error : function(request, textStatus, errorThrown) {
        alert('textStatus ' + request);

        alert('textStatus ' + textStatus);
        alert('errorThrown ' + errorThrown);
       }

          });
}

function getCreateResponse(f)
{
   var pseudoOk = verifPseudo(f.pseudo);
   var mailOk = verifMail(f.email);
   var ageOk = verifAge(f.age);
   var mdp1 = verifPass(f.mdp1);
   var mdp2 = verifPass(f.mdp2);
   
   if(mdp1 && mdp2)
      var mdpOk = checkPass(f.mdp1, f.mdp2);
   else
   var mdpOk = false;

   if(pseudoOk && mailOk && ageOk && mdpOk)
   {


var obj=new User();
obj["username"]=f.pseudo.value; // document.getElementById('nom').value
obj["password"]=f.mdp1.value;
obj["mail"]=f.email.value;
//onj["followers"]=f.pseudo.value;
var jsondata = JSON.stringify(obj); //convertir l'objet au format json





//     consol.log("ok");

//      var myJSONstr = newUserToJSon(f.pseudo, f.mdp1, f.email, "vgfrvgf");
      post("http://snenv-epitech-t3xdqsth8a.elasticbeanstalk.com/add_user", jsondata, "POST");

        alert("ok"); 
      return true;
   }
   
   else
   {
      alert("Veuillez remplir correctement tous les champs");
      return false;
   }
}
</script>
<!--<script type="text/javascript" src="../controller/c_newUser.html"></script>-->


<div name="newUserForm">
<form action="index.html" method="post" enctype="multipart/form-data" onsubmit="getCreateResponse(this)">

    Pseudo : <input type="text" name="pseudo" onblur="verifPseudo(this)" /><br />
    E-mail : <input type="text" name="email" size="30" onblur="verifMail(this)" /><br />
    Ã‚ge : <input type="text" name="age" size="2" onblur="verifAge(this)" /> ans<br />
    Mot de pass : <input type="text" name="mdp1" onblur="verifPass(this)" /><br />
    Confirmez : <input type="text" name="mdp2" onblur="verifPass(this)" /><br />
    
    <input type="submit" value="Valider"/>
</div>
</form>

<div name="GoBack">
<form action="Index.html" method="post" enctype="multipart/form-data">
    <input type="submit" value="Retour a l'acceuil"/>
</div>
</form>





</body>

</html>